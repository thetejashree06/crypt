#include <stdio.h>
#include <string.h>
#include <ctype.h>
#define SIZE 2
#define MOD 26
int key[SIZE][SIZE] = {{9, 4}, {5, 7}};
int inverseKey[SIZE][SIZE] = {{7, -4}, {-5, 9}};
void prepareText(char *text) {
    int i, len = strlen(text), j = 0;
    for (i = 0; i < len; i++) {
        if (isalpha(text[i])) {
            text[j++] = toupper(text[i]);
        }
    }
    text[j] = '\0';
    if (j % SIZE != 0) {
        text[j++] = 'X';
        text[j] = '\0';
    }
}
void multiplyMatrix(int key[SIZE][SIZE], int textVector[SIZE], int result[SIZE]) {
    for (int i = 0; i < SIZE; i++) {
        result[i] = 0;
        for (int j = 0; j < SIZE; j++) {
            result[i] += key[i][j] * textVector[j];
        }
        result[i] %= MOD;
        if (result[i] < 0) result[i] += MOD;
    }
}
void hillCipherEncrypt(char *plaintext, char *ciphertext) {
    int len = strlen(plaintext), vector[SIZE], result[SIZE];
    for (int i = 0; i < len; i += SIZE) {
        vector[0] = plaintext[i] - 'A';
        vector[1] = plaintext[i + 1] - 'A';
        multiplyMatrix(key, vector, result);
        ciphertext[i] = result[0] + 'A';
        ciphertext[i + 1] = result[1] + 'A';
    }
    ciphertext[len] = '\0';
}
void hillCipherDecrypt(char *ciphertext, char *decryptedText) {
    int len = strlen(ciphertext), vector[SIZE], result[SIZE];
    for (int i = 0; i < len; i += SIZE) {
        vector[0] = ciphertext[i] - 'A';
        vector[1] = ciphertext[i + 1] - 'A';
        multiplyMatrix(inverseKey, vector, result);
        decryptedText[i] = result[0] + 'A';
        decryptedText[i + 1] = result[1] + 'A';
    }
    decryptedText[len] = '\0';
}
int main() {
    char plaintext[] = "MEET ME AT THE USUAL PLACE AT TEN RATHER THAN EIGHT OCLOCK";
    char ciphertext[100], decryptedText[100];
    prepareText(plaintext);
    hillCipherEncrypt(plaintext, ciphertext);
    hillCipherDecrypt(ciphertext, decryptedText);
    printf("Ciphertext: %s\n", ciphertext);
    printf("Decrypted Text: %s\n", decryptedText);
    return 0;
}

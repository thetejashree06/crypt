#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define MAX 1000
#define ALPHA 26

char englishFreq[] = "ETAOINSHRDLCUMWFGYPBVKJXQZ";

typedef struct {
    char text[MAX];
    int score;
} Candidate;

int compare(const void *a, const void *b) {
    return ((Candidate *)b)->score - ((Candidate *)a)->score;
}

int main() {
    char cipher[MAX] = "WKLV LV D PRQRDOSKDEHWLF VXEVWLWXWLRQ FLSKHU";
    int topN = 10;

    int freq[ALPHA] = {0};
    int len = strlen(cipher);

    for (int i = 0; i < len; i++)
        if (cipher[i] >= 'A' && cipher[i] <= 'Z')
            freq[cipher[i] - 'A']++;

    int idx[ALPHA];
    for (int i = 0; i < ALPHA; i++) idx[i] = i;

    for (int i = 0; i < ALPHA - 1; i++)
        for (int j = i + 1; j < ALPHA; j++)
            if (freq[idx[j]] > freq[idx[i]]) {
                int t = idx[i];
                idx[i] = idx[j];
                idx[j] = t;
            }

    Candidate results[ALPHA];

    for (int s = 0; s < ALPHA; s++) {
        char map[ALPHA];

        for (int i = 0; i < ALPHA; i++)
            map[idx[i]] = englishFreq[(i + s) % ALPHA];

        for (int i = 0; i < len; i++) {
            if (cipher[i] >= 'A' && cipher[i] <= 'Z')
                results[s].text[i] = map[cipher[i] - 'A'];
            else
                results[s].text[i] = cipher[i];
        }
        results[s].text[len] = '\0';
        results[s].score = 26 - s;
    }

    qsort(results, ALPHA, sizeof(Candidate), compare);

    printf("Top %d possible plaintexts:\n\n", topN);
    for (int i = 0; i < topN && i < ALPHA; i++)
        printf("%2d: %s\n", i + 1, results[i].text);

    return 0;
}

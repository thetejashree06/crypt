#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define MAX 1000
#define ALPHABET 26

double english_freq[26] = {
    8.167,1.492,2.782,4.253,12.702,2.228,2.015,
    6.094,6.966,0.153,0.772,4.025,2.406,6.749,
    7.507,1.929,0.095,5.987,6.327,9.056,2.758,
    0.978,2.360,0.150,1.974,0.074
};

typedef struct {
    char text[MAX];
    int key;
    double score;
} Candidate;

double score_text(char *text) {
    int freq[26] = {0};
    int len = 0;

    for (int i = 0; text[i]; i++) {
        if (text[i] >= 'A' && text[i] <= 'Z') {
            freq[text[i] - 'A']++;
            len++;
        }
    }

    double score = 0;
    for (int i = 0; i < 26; i++) {
        double observed = (double)freq[i] / len * 100;
        score += observed * english_freq[i];
    }
    return score;
}

void decrypt(char *cipher, char *plain, int key) {
    for (int i = 0; cipher[i]; i++) {
        if (cipher[i] >= 'A' && cipher[i] <= 'Z')
            plain[i] = ((cipher[i] - 'A' - key + 26) % 26) + 'A';
        else
            plain[i] = cipher[i];
    }
}

int compare(const void *a, const void *b) {
    double diff = ((Candidate *)b)->score - ((Candidate *)a)->score;
    return (diff > 0) ? 1 : -1;
}

int main() {
    char ciphertext[MAX] = "WKLV LV D FDHVDU FLSKHU";
    int topN = 10;

    Candidate results[26];

    for (int k = 0; k < 26; k++) {
        decrypt(ciphertext, results[k].text, k);
        results[k].key = k;
        results[k].score = score_text(results[k].text);
    }

    qsort(results, 26, sizeof(Candidate), compare);

    printf("Top %d possible plaintexts:\n\n", topN);
    for (int i = 0; i < topN && i < 26; i++) {
        printf("%2d) Key = %2d : %s\n",
               i + 1, results[i].key, results[i].text);
    }

    return 0;
}
